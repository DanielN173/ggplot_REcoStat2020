<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>ggplot2</title>
    <meta charset="utf-8" />
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <script src="libs/xaringanExtra-logo/logo.js"></script>
    <link rel="stylesheet" href="custom-fonts.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# <code>ggplot2</code>
## Maria Novosolov
### 21-04-2020

---




<style type="text/css">
.xaringan-extra-logo {
  width: 110px;
  height: 128px;
  z-index: 0;
  background-image: url('img/logo.png');
  background-size: contain;
  background-repeat: no-repeat;
  position: absolute;
  top:1em;right:1em;
}
</style>

class: center, middle

# The idea behind `ggplot2`

Combining all the good and leaving out all the bad of all base R packages for plotting

---

# Some examples

![](img/Picture1.png)

---

# What `ggplot2` can do?

Almost anything you want it

.center[
&lt;img src="img/15912721.png" width=40%&gt;
]
---

# What `ggplot2` can't do?

It can't choose for you which graphics represent your data best

.center[
&lt;img src="img/choose_graphics.jpg" width=50%&gt;
]

---

# The basics of `ggplot2`

* Based on the Grammar of Graphics (Wilkinson, 2005)

* Based on a layer system

* Flexible set of components for creating any type of graphics

---

# Specification

Components of a graphic:

* **DATA** - the dataset that will be used for the other components

* **TRANS** - variable transformation

* **SCALE** - scale transformation

* **ELEMENT** - graphs and their aesthetic attributes

* **COORD** - a coordinate system

* **GUIDE** - one or more guides

---

class: center, middle

## Install the package using `install.packages("ggplot2")`

## load the package with `library(ggplot2)`

---

# Two options of working with the package

**`qplot()`** - quick and dirty plotting. Limitted options

**`ggplot()`** - base function for more versetile plotting

---

.center[
# `qplot()`
]

* Syntex similar the the `base` R `plot()`

* **x** == predictor

* **y** == response

* **data** == the data frame that holds the variables to plot


```r
qplot(x,y,data = mydata)
```

---

# Example using the `iris` dataset



```r
qplot(x = Sepal.Width,y = Petal.Width,data = iris)
```

![](ggplot2_files/figure-html/unnamed-chunk-2-1.png)&lt;!-- --&gt;

---
# The building blocks of `ggplot()`


A .green[**plot**] is made up of multiple layers. 

A .green[**layer**] consists of data, a set of
mappings between variables and
.green[**aes**]thetics, a .green[**geom**]etric object and a
.green[**stat**]istical transformation.

.green[**Scales**] control the details of the mapping.
All components are independent and
reusable.

---

# Adventages of the layers system

* Change a single feature at a time

* Create new types of plots on the fly

* Cure against immobility

* Developers can easily develop new layers without affecting other layers

---

class: inverse, center, middle

# Lets dive into the syntex


![](img/dive.png)

---

# Anatomy of the plot

1. .green[**Data**] – the dataset name that you want to present

2. .green[**Aesthetics**] – the variables you want to use in the plot

3. .green[**Geom**] – the type of plot you want do

4. **Themes** – control presentation of non-data elements

5. **Stat** – statistical transformations 

6. **Scale** – define parameters of the plot (exp: x-axis, color, etc.)

.bottom-left[
*The green variables are mandatory to create a plot
]
---

# 1. Data

In `ggplot()` you always have to specify what data you are using for the plot.

Thus, you always work with data.frames/tibbles


```r
ggplot(data = iris,aes(x = Sepal.Width,y = Petal.Width))
```

![](ggplot2_files/figure-html/unnamed-chunk-3-1.png)&lt;!-- --&gt;

.footnote[
*R function are placment based which means it anticipates the parameters type based on location. So you dont have to write "data", "x", "y" if you place them in the right place
]
---

# 2. Aesthetic mapping

In `ggplot()` land it means "something you can see" and it includes:

* Position (x and y)

* Color (a name of a color or a vector that will be used for color)

* Fill (a name of a color or a vector that will be used for color)

* Shape (a name of a shape or a vector that will be used for shape)

* Line type

* Size

---

# 3. Geometric obejs aka `geom`

* A geom can only display certain aesthetics

* A plot must have at least one geom but there is no upper limit

---

# Lets look at some examples using **PanTHERIA** dataset

**Load the data**


```r
pantheria&lt;- read_csv("data/sub_PanTHERIA.csv") %&gt;% 
  na.omit() %&gt;% mutate(HabitatBreadth = as.character(HabitatBreadth))
pantheria
```

```
## # A tibble: 47 x 20
##    Order Family Genus Species Binomial ActivityCycle AdultBodyMass
##    &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;    &lt;chr&gt;                 &lt;dbl&gt;
##  1 Carn… Canid… Canis lupus   Canis l… both                31757. 
##  2 Dide… Didel… Calu… philan… Calurom… nocturnal             246. 
##  3 Peri… Equid… Equus zebra   Equus z… diurnal            282462. 
##  4 Erin… Erina… Erin… europa… Erinace… both                  778. 
##  5 Arti… Bovid… Bison bison   Bison b… both               624577. 
##  6 Sori… Soric… Blar… brevic… Blarina… nocturnal              18.6
##  7 Dide… Didel… Dide… marsup… Didelph… nocturnal            1135. 
##  8 Dide… Didel… Dide… virgin… Didelph… nocturnal            2442. 
##  9 Prim… Lemur… Eule… macaco  Eulemur… both                 2470. 
## 10 Prim… Lemur… Eule… mongoz  Eulemur… both                 1771. 
## # … with 37 more rows, and 13 more variables: AgeatFirstBirth &lt;dbl&gt;,
## #   DietBreadth &lt;dbl&gt;, GestationLen &lt;dbl&gt;, HabitatBreadth &lt;chr&gt;,
## #   HomeRange &lt;dbl&gt;, LitterSize &lt;dbl&gt;, LittersPerYear &lt;dbl&gt;,
## #   MaxLongevity &lt;dbl&gt;, NeonateBodyMass &lt;dbl&gt;, PopulationDensity &lt;dbl&gt;,
## #   SexualMaturityAge &lt;dbl&gt;, Terrestriality &lt;chr&gt;, TrophicLevel &lt;chr&gt;
```

---
## `geom_histogram()`



```r
ggplot(pantheria,aes(x = log10(AdultBodyMass)))+
  geom_histogram()
```

![](ggplot2_files/figure-html/unnamed-chunk-5-1.png)&lt;!-- --&gt;

---

## `geom_point()`


```r
ggplot(pantheria,aes(log10(AdultBodyMass),log10(LitterSize)))+
  geom_point()
```

![](ggplot2_files/figure-html/unnamed-chunk-6-1.png)&lt;!-- --&gt;

---

# 4. Statistical Transformations

* Each geom has a default statistic, but these can be changed

* plots, such as boxplots, barplot, prediction lines etc. require statistical transformations

---

# Example


```r
ggplot(pantheria,aes(Order,log10(AdultBodyMass)))+
  geom_bar()
```

```
## Error: stat_count() can only have an x or y aesthetic.
```

![](ggplot2_files/figure-html/unnamed-chunk-7-1.png)&lt;!-- --&gt;


.bottom-left[
The defult statistics for `geom_bar()` is a histogram count. 
]
---

**The fix**


```r
ggplot(pantheria,aes(Order,log10(AdultBodyMass)))+
  geom_bar(stat = "identity")
```

![](ggplot2_files/figure-html/unnamed-chunk-8-1.png)&lt;!-- --&gt;

---

# 5. Scales

* Control mapping from data to aesthetic attributes

* One scale per aesthetic

* general syntex: `scale_&lt;aesthetic&gt;_&lt;type&gt;`


---

# Examples

### Plotting using defult colors


```r
ggplot(pantheria,aes(log10(AdultBodyMass),log10(LitterSize),
                     color = ActivityCycle))+
  geom_point()
```

![](ggplot2_files/figure-html/unnamed-chunk-9-1.png)&lt;!-- --&gt;

---
### Plotting with `scale` option

**Scale color using `RColorBrewer`**

```r
library(RColorBrewer)
ggplot(pantheria,aes(log10(AdultBodyMass),log10(LitterSize),
                     color = ActivityCycle))+
  geom_point()+
* scale_color_brewer(palette = "Dark2")
```

![](ggplot2_files/figure-html/unnamed-chunk-10-1.png)&lt;!-- --&gt;

---

## Scaling something that is not defined does nothing


```r
ggplot(pantheria,aes(log10(AdultBodyMass),log10(LitterSize),
                     color = ActivityCycle))+
  geom_point()+
  scale_color_brewer(palette = "Dark2")+
  scale_shape()
```

![](ggplot2_files/figure-html/unnamed-chunk-11-1.png)&lt;!-- --&gt;

---
## So how to scale shape?


```r
ggplot(pantheria,aes(log10(AdultBodyMass),log10(LitterSize),
*                    color = ActivityCycle,shape = ActivityCycle))+
  geom_point()+
  scale_color_brewer(palette = "Dark2")+
  scale_shape()
```

---
.center[
![](ggplot2_files/figure-html/unnamed-chunk-13-1.png)&lt;!-- --&gt;
]

---

# 6. Faceting

* Lay out multiple plots on a page

* Plot subsets into different panels

### **Formula options**


&lt;img src="img/faceting_formula.png" width=50%&gt;


---

## Example

Plot the litter size as a function of body mass for each trophic level seperatly while keeping the shape-color scaling for acticity cycle

`facet_wrap()`: define subsets as the levels of a single grouping variable


```r
ggplot(pantheria,aes(log10(AdultBodyMass),log10(LitterSize),
                     color = ActivityCycle,shape = ActivityCycle))+
  geom_point()+
  scale_color_brewer(palette = "Dark2")+
  scale_shape()+
* facet_wrap(TrophicLevel~.)
```

---
.center[
![](ggplot2_files/figure-html/unnamed-chunk-15-1.png)&lt;!-- --&gt;
]

---

`facet_grid()`: define subsets as the crossing of two grouping variables


```r
ggplot(pantheria,aes(log10(AdultBodyMass),log10(LitterSize),
                     color = ActivityCycle,shape = ActivityCycle))+
  geom_point()+
  scale_color_brewer(palette = "Dark2")+
  scale_shape()+
* facet_grid(TrophicLevel~HabitatBreadth)
```

---
.center[
![](ggplot2_files/figure-html/unnamed-chunk-17-1.png)&lt;!-- --&gt;
]

---

### Scale axis in facet

When you have different values for the x or y axis in your data you need to scale it when faceting

&lt;img src="img/facets_scale.png" width=50%&gt;

* The axis are fixed by defult

---

## Example


```r
ggplot(pantheria,aes(log10(AdultBodyMass),log10(LitterSize),
                     color = ActivityCycle,shape = ActivityCycle))+
  geom_point()+
  scale_color_brewer(palette = "Dark2")+
  scale_shape()+
* facet_grid(TrophicLevel~HabitatBreadth,scales = "free")
```

---
.center[
![](ggplot2_files/figure-html/unnamed-chunk-19-1.png)&lt;!-- --&gt;
]

---

# 7. Themes

* handles non-data plot elements such as:
    * Axis labels
    * Plot background
    * Facet label background
    * Legend appearance
---

## Example


```r
ggplot(pantheria,aes(log10(AdultBodyMass),log10(LitterSize),
                     color = ActivityCycle,shape = ActivityCycle))+
  geom_point()+
  scale_color_brewer(palette = "Dark2")+
  scale_shape()+
  facet_grid(TrophicLevel~HabitatBreadth,scales = "free") +
* theme_light()
```

---
.center[
![](ggplot2_files/figure-html/unnamed-chunk-21-1.png)&lt;!-- --&gt;
]

---

```r
ggplot(pantheria,aes(log10(AdultBodyMass),log10(LitterSize),
                     color = ActivityCycle,shape = ActivityCycle))+
  geom_point()+
  scale_color_brewer(palette = "Dark2")+
  scale_shape()+
  facet_grid(TrophicLevel~HabitatBreadth,scales = "free") +
  theme_light()+
* theme(legend.position = "none")
```

---
.center[
![](ggplot2_files/figure-html/unnamed-chunk-23-1.png)&lt;!-- --&gt;
]

---

# 8. Position adjustments

* Tweak positioning of geometric objects

* Avoid overlaps

---

## Example

If we add fill to the barplot from before without position adjusment we see that the parameters are stacked one on top of each other 


```r
ggplot(pantheria,aes(Order,log10(AdultBodyMass),fill = ActivityCycle))+
  geom_bar(stat = "identity")
```

![](ggplot2_files/figure-html/unnamed-chunk-24-1.png)&lt;!-- --&gt;

---

**To put them one next to the other we will use `position_dodge()`

```r
ggplot(pantheria,aes(Order,log10(AdultBodyMass),fill = ActivityCycle))+
  geom_bar(stat = "identity",width = 0.6,
*          position = position_dodge(width = 1))
```

![](ggplot2_files/figure-html/unnamed-chunk-25-1.png)&lt;!-- --&gt;

---

# `position_jitter()`

**Avoid overplotting by jittering points**

This is useful for **boxplot** and **violin** plot

```r
ggplot(pantheria,aes(ActivityCycle,log10(AdultBodyMass)))+
  geom_boxplot()+
* geom_jitter(alpha = 0.6,width = 0.2)
```

---
.center[
![](ggplot2_files/figure-html/unnamed-chunk-27-1.png)&lt;!-- --&gt;
]

---

# Summary

* Allows creating high quality plots
* Many options
* Many blogs and webpages explaining how to do different plots in ggplot
* Disadvantage – takes time to learn the grammar

### The book:
https://ggplot2-book.org/

---

# Useful links
* https://bradleyboehmke.github.io/tutorials/barchart
* http://www.sthda.com/english/wiki/ggplot2-barplots-quick-start-guide-r-software-and-data-visualization
* color pallete generator: https://coolors.co/
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="libs/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
